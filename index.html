<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Master PRO - Cliente</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React y Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
      // Importaciones necesarias de Firebase
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import { getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot, query, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
      import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      
      // Hacemos que las funciones de Firebase est√©n disponibles globalmente en el scope de Babel
      window.initializeApp = initializeApp;
      window.getFirestore = getFirestore;
      window.collection = collection;
      window.doc = doc;
      window.setDoc = setDoc;
      window.deleteDoc = deleteDoc;
      window.onSnapshot = onSnapshot;
      window.query = query;
      window.getDoc = getDoc;
      window.getAuth = getAuth;
      window.signInWithEmailAndPassword = signInWithEmailAndPassword;
      window.signOut = signOut;
      window.onAuthStateChanged = onAuthStateChanged;

      // Configuraciones de Tailwind (Se puede omitir la configuraci√≥n aqu√≠ si ya est√° en el body)
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            animation: {
              'fade-in-up': 'fadeInUp 0.5s ease-out',
              'fade-in': 'fadeIn 0.5s ease-out',
            },
            keyframes: {
              fadeInUp: {
                '0%': { opacity: 0, transform: 'translateY(10px)' },
                '100%': { opacity: 1, transform: 'translateY(0)' },
              },
              fadeIn: {
                '0%': { opacity: 0 },
                '100%': { opacity: 1 },
              }
            }
          },
        }
      }
    </script>

    <!-- Estilo de impresi√≥n para el cart√≥n -->
    <style>
        /* Estilos espec√≠ficos para la impresi√≥n */
        @media print {
            /* Oculta todos los elementos excepto el contenido a imprimir */
            body * {
                visibility: hidden;
            }
            /* Muestra el contenedor del ticket y todo su contenido */
            #root, #root * {
                visibility: visible;
            }
            #root {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
            }
            /* Asegura que los elementos de control no se impriman */
            .no-print {
                display: none !important;
            }
            /* Ajusta el tama√±o de la cuadr√≠cula para impresi√≥n */
            .bingo-grid {
                width: 100%;
            }
        }
        /* Estilos para el efecto de carga */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #ffffff;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 font-sans">
    <!-- Contenedor donde React renderizar√° la aplicaci√≥n -->
    <div id="root">
        <div class="h-screen flex items-center justify-center">
            <div class="spinner"></div>
            <p class="ml-4 text-lg text-slate-600">Cargando Bingo App...</p>
        </div>
    </div>

    <!-- Script de la Aplicaci√≥n (C√ìDIGO REACT/JSX) -->
    <script type="text/babel">
    const { useState, useEffect, createElement } = React;
    
    /**
     * ------------------------------------------------------------------
     * CONFIGURACI√ìN DE FIREBASE (¬°IMPORTANTE!)
     * ------------------------------------------------------------------
     * PEGAR AQU√ç LA CONFIGURACI√ìN DEL CLIENTE
     * ------------------------------------------------------------------
     */
    const firebaseConfig = {
      apiKey: "AIzaSyDI3PYFDvQJ1CtF_hLVhhn1jc0_5S1Aog0",
      authDomain: "bingosue-cfca8.firebaseapp.com",
      projectId: "bingosue-cfca8",
      storageBucket: "bingosue-cfca8.firebasestorage.app",
      messagingSenderId: "167707585444",
      appId: "1:167707585444:web:5bbd5ea2d3242df59f6f31"
    };

    // Inicializamos Firebase y obtenemos las instancias de DB y Auth
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Lucide Icons (se importan como componentes React)
    const Search = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('circle', { cx: 11, cy: 11, r: 8 }), createElement('path', { d: "m21 21-4.3-4.3" }));
    const UserPlus = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" }), createElement('circle', { cx: 9, cy: 7, r: 4 }), createElement('line', { x1: 19, y1: 8, x2: 19, y2: 14 }), createElement('line', { x1: 22, y1: 11, x2: 16, y2: 11 }));
    const Trash2 = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "M3 6h18" }), createElement('path', { d: "M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" }), createElement('path', { d: "M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" }), createElement('line', { x1: 10, y1: 11, x2: 10, y2: 17 }), createElement('line', { x1: 14, y1: 11, x2: 14, y2: 17 }));
    const LogOut = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" }), createElement('polyline', { points: "16 17 21 12 16 7" }), createElement('line', { x1: 21, y1: 12, x2: 9, y2: 12 }));
    const Check = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('polyline', { points: "20 6 9 17 4 12" }));
    const Sparkles = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "m12 3-1.83 2.66c-.34.5-1.14.5-1.48 0L6.83 3" }), createElement('path', { d: "m5 10-.64 3.01c-.13.63.38 1.25 1.01 1.38L8 15" }), createElement('path', { d: "m20 10-.64 3.01c-.13.63.38 1.25 1.01 1.38L16 15" }), createElement('path', { d: "m12 21 1.83-2.66c.34-.5 1.14-.5 1.48 0L17.17 21" }), createElement('path', { d: "m7 17-3.64-3.01c-.63-.13-1.14-.75-1.01-1.38L4 10" }), createElement('path', { d: "m17 17 3.64-3.01c.63-.13 1.14-.75 1.01-1.38L20 10" }));
    const Hash = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('line', { x1: 4, y1: 9, x2: 20, y2: 9 }), createElement('line', { x1: 4, y1: 15, x2: 20, y2: 15 }), createElement('line', { x1: 10, y1: 3, x2: 8, y2: 21 }), createElement('line', { x1: 16, y1: 3, x2: 14, y2: 21 }));
    const X = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "M18 6 6 18" }), createElement('path', { d: "m6 6 12 12" }));
    const Printer = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('polyline', { points: "6 9 6 2 18 2 18 9" }), createElement('path', { d: "M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" }), createElement('rect', { width: 12, height: 8, x: 6, y: 14 }), createElement('line', { x1: 12, y1: 14, x2: 12, y2: 22 }));
    const Lock = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('rect', { width: 18, height: 11, x: 3, y: 11, rx: 2, ry: 2 }), createElement('path', { d: "M7 11V7a5 5 0 0 1 10 0v4" }));
    const Loader2 = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "M21 12a9 9 0 1 1-6.219-8.56" }));


    /**
     * LOGICA DEL BINGO (Generador Matem√°tico)
     */
    const generateBingoMatrix = () => {
      // Funci√≥n para obtener n√∫meros √∫nicos en un rango
      const getUniqueNumbers = (min, max, count) => {
        const nums = new Set();
        while (nums.size < count) {
          nums.add(Math.floor(Math.random() * (max - min + 1)) + min);
        }
        return Array.from(nums).sort((a, b) => a - b); // Ordenar para mejor visualizaci√≥n
      };
      // Generar las 5 columnas seg√∫n las reglas del Bingo (B: 1-15, I: 16-30, N: 31-45, G: 46-60, O: 61-75)
      return {
        B: getUniqueNumbers(1, 15, 5),
        I: getUniqueNumbers(16, 30, 5),
        N: getUniqueNumbers(31, 45, 4), // 4 n√∫meros + el Free
        G: getUniqueNumbers(46, 60, 5),
        O: getUniqueNumbers(61, 75, 5),
      };
    };

    /**
     * COMPONENTES VISUALES
     */
    const BingoGrid = ({ numbers, colorTheme }) => {
      const { B, I, N, G, O } = numbers;
      const letters = ['B', 'I', 'N', 'G', 'O'];
      const headerColors = {
        blue: ['bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500', 'bg-purple-500'],
        purple: ['bg-pink-500', 'bg-purple-500', 'bg-indigo-500', 'bg-blue-500', 'bg-cyan-500']
      };
      const currentTheme = headerColors[colorTheme] || headerColors.blue;

      // Unir todas las columnas en un solo array para mapear filas
      const columns = [B, I, N, G, O];

      return (
        <div className="bingo-grid bg-white p-2 rounded-lg border-2 border-slate-200 shadow-sm">
          <div className="grid grid-cols-5 gap-1 text-center mb-1">
            {letters.map((l, i) => (
              <div key={l} className={`${currentTheme[i]} text-white font-black text-sm sm:text-lg rounded h-6 sm:h-8 flex items-center justify-center shadow-sm`}>
                {l}
              </div>
            ))}
          </div>
          <div className="grid grid-cols-5 gap-1 text-center font-bold text-slate-800 text-sm sm:text-base">
            {[0, 1, 2, 3, 4].map((row) => (
              <React.Fragment key={row}>
                {columns.map((col, colIndex) => {
                  let content;
                  let cellClass = "h-6 sm:h-8 flex items-center justify-center bg-slate-50 rounded border border-slate-100";
                  
                  // Columna N (√≠ndice 2) y Fila 2 (√≠ndice 2) es el espacio libre
                  if (colIndex === 2 && row === 2) {
                    content = <Sparkles size={14} className="text-white" />;
                    cellClass = "h-6 sm:h-8 flex items-center justify-center bg-yellow-400 rounded-full border-2 border-white shadow-lg z-20 text-xs"; // Cuidado con el z-20, puede afectar la impresi√≥n
                  } else {
                    // Manejar la columna N que solo tiene 4 n√∫meros (el 5to es el FREE)
                    let number;
                    if (colIndex === 2) {
                      number = row < 2 ? col[row] : col[row - 1]; // Toma el 4to n√∫mero en la posici√≥n de la fila 4
                    } else {
                      number = col[row];
                    }
                    content = number;
                  }

                  return (
                    <div key={colIndex} className={cellClass}>
                      {content}
                    </div>
                  );
                })}
              </React.Fragment>
            ))}
          </div>
        </div>
      );
    };

    const FullTicket = ({ player }) => {
      // Asegurar que player y player.grids existan y tengan al menos 2 elementos
      if (!player || !player.grids || player.grids.length < 2) return null;

      return (
        <div id="bingo-ticket-export" className="bg-white p-4 sm:p-6 rounded-3xl shadow-2xl max-w-3xl mx-auto border-t-8 border-indigo-600 relative overflow-hidden">
          <div className="text-center mb-6 relative z-10">
            <div className="inline-flex items-center justify-center gap-2 bg-indigo-100 text-indigo-700 px-4 py-1 rounded-full text-sm font-bold mb-2">
              <Hash size={14} /> TICKET #{player.id}
            </div>
            <h2 className="text-3xl sm:text-4xl font-black text-slate-800 uppercase">GRAN BINGO <span className="text-indigo-600">MASTER</span></h2>
            <p className="text-slate-500 font-medium text-lg mt-1 uppercase">{player.name}</p>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 relative z-10">
            <div className="relative">
              <div className="absolute -top-3 -left-2 bg-yellow-400 text-yellow-900 font-bold w-8 h-8 flex items-center justify-center rounded-full border-2 border-white shadow-lg z-20 text-xs">01</div>
              <BingoGrid numbers={player.grids[0]} colorTheme="blue" />
            </div>
            <div className="relative">
              <div className="absolute -top-3 -right-2 bg-yellow-400 text-yellow-900 font-bold w-8 h-8 flex items-center justify-center rounded-full border-2 border-white shadow-lg z-20 text-xs">02</div>
              <BingoGrid numbers={player.grids[1]} colorTheme="purple" />
            </div>
          </div>
          <div className="mt-6 pt-4 border-t border-dashed border-slate-300 flex justify-between items-center text-xs text-slate-400">
            <span>Generado autom√°ticamente</span>
            <span className="flex items-center gap-1"><Check size={12} /> Verificado</span>
          </div>
        </div>
      );
    };

    /**
     * APP PRINCIPAL
     */
    const App = () => {
      const [activeTab, setActiveTab] = useState('home'); 
      const [players, setPlayers] = useState([]);
      const [searchCode, setSearchCode] = useState('');
      const [foundPlayer, setFoundPlayer] = useState(null);
      
      // Auth States
      const [user, setUser] = useState(null);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [authError, setAuthError] = useState('');

      // Admin Action States
      const [newName, setNewName] = useState('');
      const [newId, setNewId] = useState('');
      const [loading, setLoading] = useState(false); // Para el bot√≥n de b√∫squeda/login
      const [actionLoading, setActionLoading] = useState(false); // Para acciones de Admin (crear/eliminar)

      // Funci√≥n para mostrar mensajes personalizados (Sustituto de alert())
      const showToast = (message) => {
          const modal = document.getElementById('error-modal');
          const msg = document.getElementById('modal-message');
          msg.innerText = message;
          modal.classList.remove('hidden');
          modal.classList.add('animate-fade-in-up');
          setTimeout(() => {
             modal.classList.add('hidden');
             modal.classList.remove('animate-fade-in-up');
          }, 3000);
      };

      // 1. Escuchar Autenticaci√≥n
      useEffect(() => {
        const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
          setUser(currentUser);
        });
        return () => unsubscribe();
      }, []);

      // 2. Escuchar Base de Datos (Solo si es admin)
      useEffect(() => {
        // Ejecutar solo si el usuario admin est√° logeado y en la pesta√±a de admin
        if (user && activeTab === 'admin') {
          // Utilizaremos el UID del usuario logeado para asegurar que solo el due√±o de la app
          // pueda acceder a su lista de jugadores si us√°ramos una estructura por UID.
          // En este caso, usaremos una colecci√≥n global `players` y nos basaremos
          // en las reglas de seguridad de Firestore para restringir el acceso.
          try {
            const q = query(collection(db, "players"));
            const unsubscribe = onSnapshot(q, (querySnapshot) => {
              const playersList = [];
              querySnapshot.forEach((doc) => {
                // Incluir doc.id ya que es el n√∫mero de cart√≥n (ej: '001')
                playersList.push({ id: doc.id, ...doc.data() }); 
              });
              
              // Ordenar por ID num√©rico
              playersList.sort((a, b) => parseInt(a.id) - parseInt(b.id));
              setPlayers(playersList);
              
              // Calcular el siguiente ID disponible
              if(playersList.length > 0) {
                  const lastId = Math.max(...playersList.map(p => parseInt(p.id)));
                  // Asegurar formato de 3 d√≠gitos (ej: '001')
                  setNewId(String(lastId + 1).padStart(3, '0')); 
              } else {
                  setNewId('001');
              }
            }, (error) => {
                console.error("Error en onSnapshot (probablemente reglas de seguridad):", error);
                // Mostrar error si la regla de lectura fall√≥ (admin no tiene permiso)
                setAuthError("Error de lectura: Aseg√∫rate de que tus reglas de Firestore permitan la lectura a usuarios autenticados.");
            });
            return () => unsubscribe();
          } catch (e) {
            console.error("Error al suscribirse a Firestore:", e);
            setAuthError("Error de conexi√≥n con la base de datos.");
            return () => {};
          }
        } else {
            setPlayers([]); // Limpiar si no es admin
            setNewId('001'); // Resetear ID
            return () => {};
        }
      }, [user, activeTab]);

      // --- M√âTODOS ---

      const handleSearch = async (e) => {
        e.preventDefault();
        // El ID debe ser un n√∫mero de 3 d√≠gitos (ej: '001')
        const formattedCode = searchCode.replace(/[^0-9]/g, '').padStart(3, '0');
        if(!formattedCode || formattedCode.length > 3 || formattedCode === '000') {
            showToast('‚ö†Ô∏è Ingresa un c√≥digo de cart√≥n v√°lido (ej: 001)');
            return;
        }
        setLoading(true);
        setFoundPlayer(null);

        try {
          // Buscamos el documento por su ID ('001', '002', etc.)
          const docRef = doc(db, "players", formattedCode);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists()) {
            setFoundPlayer({id: docSnap.id, ...docSnap.data()});
            setActiveTab('result');
          } else {
             showToast('‚ùå No encontramos ese n√∫mero de cart√≥n.');
          }
        } catch (error) {
          console.error("Error buscando:", error);
           showToast("Error de conexi√≥n. Intenta m√°s tarde.");
        }
        setLoading(false);
      };

      const handleLogin = async (e) => {
        e.preventDefault();
        setAuthError('');
        setLoading(true);
        try {
          await signInWithEmailAndPassword(auth, email, password);
          setActiveTab('admin');
        } catch (error) {
          // Firebase Authentication codes
          const errorCode = error.code;
          if (errorCode === 'auth/wrong-password' || errorCode === 'auth/user-not-found') {
              setAuthError('Credenciales incorrectas. Revisa tu email y contrase√±a.');
          } else {
              setAuthError(`Error de autenticaci√≥n: ${errorCode}`);
          }
        }
        setLoading(false);
      };

      const handleLogout = async () => {
        await signOut(auth);
        setActiveTab('home');
      };

      const handleCreatePlayer = async (e) => {
        e.preventDefault();
        const formattedId = newId.replace(/[^0-9]/g, '').padStart(3, '0');
        if(!newName || !formattedId || formattedId === '000') {
            showToast('‚ö†Ô∏è Debes ingresar un nombre y un n√∫mero de cart√≥n v√°lido.');
            return;
        }
        setActionLoading(true);

        try {
          const docRef = doc(db, "players", formattedId);
          const docSnap = await getDoc(docRef);

          // Usamos un modal UI para la confirmaci√≥n, ya que alert/confirm est√°n prohibidos
          if (docSnap.exists()) {
              if (!window.confirm(`El cart√≥n #${formattedId} ya existe para ${docSnap.data().name}. ¬øQuieres sobrescribirlo?`)) {
                  setActionLoading(false);
                  return;
              }
          }

          // Usamos setDoc para definir nosotros el ID del documento (ej: "001")
          await setDoc(docRef, {
            id: formattedId,
            name: newName,
            createdAt: new Date().toISOString(),
            grids: [generateBingoMatrix(), generateBingoMatrix()] // Generamos 2 cartones
          });
          setNewName('');
          showToast(`‚úÖ Cart√≥n #${formattedId} creado/actualizado para ${newName}`);
          
        } catch (error) {
          console.error("Error creando:", error);
           showToast("‚ùå Error al guardar en base de datos. Revisa las reglas de 'write'.");
        }
        setActionLoading(false);
      };

      const handleDelete = async (id, name) => {
        // Uso de confirm nativo, pero si fallara en el entorno de Canvas, 
        // se debe implementar un modal React personalizado.
        if(window.confirm(`¬øEst√°s seguro de borrar el cart√≥n #${id} (${name})? Esta acci√≥n es permanente.`)) {
          try {
            await deleteDoc(doc(db, "players", id));
            showToast(`üóëÔ∏è Cart√≥n #${id} eliminado.`);
          } catch (error) {
             console.error("Error al eliminar:", error);
             showToast("‚ùå Error al eliminar. Revisa las reglas de seguridad (delete).");
          }
        }
      };

      const handlePrint = () => window.print();

      return (
        <div className="min-h-screen bg-slate-50 text-slate-800 font-sans selection:bg-indigo-200">
          {/* NAVBAR */}
          <nav className="bg-white sticky top-0 z-50 border-b border-slate-200 no-print shadow-sm">
            <div className="max-w-5xl mx-auto px-4 h-16 flex justify-between items-center">
              <div 
                onClick={() => { setActiveTab('home'); setSearchCode(''); setFoundPlayer(null); }}
                className="flex items-center gap-2 cursor-pointer transition-all hover:opacity-80"
              >
                <Sparkles className="text-indigo-600 fill-indigo-100" />
                <span className="font-black text-xl tracking-tight">BINGO<span className="text-indigo-600">PRO</span></span>
              </div>

              {user ? (
                 <button onClick={() => setActiveTab('admin')} className="text-sm font-medium text-slate-500 hover:text-indigo-600 flex items-center gap-1 transition-colors">
                    <Lock size={16}/> PANEL ADMIN
                 </button>
              ) : (
                <button onClick={() => setActiveTab('admin')} className="text-sm font-medium text-slate-500 hover:text-indigo-600 flex items-center gap-1 transition-colors">
                  <Lock size={16}/> Admin
                </button>
              )}
              
              {user && (
                 <button onClick={handleLogout} className="text-sm font-medium text-red-500 hover:text-red-700 flex items-center gap-1 transition-colors">
                   <LogOut size={16}/> Salir
                 </button>
              )}
            </div>
          </nav>

          <main className="max-w-5xl mx-auto p-4 md:p-8 flex flex-col items-center min-h-[80vh]">

            {/* VISTA 1: BUSCADOR */}
            {activeTab === 'home' && (
              <div className="w-full max-w-md mt-10 animate-fade-in-up text-center">
                <div className="mb-8">
                  <h1 className="text-4xl font-black text-slate-900 mb-2">Busca tu Cart√≥n</h1>
                  <p className="text-slate-500">Ingresa tu n√∫mero de ticket para ver tus cartas.</p>
                </div>

                <form onSubmit={handleSearch} className="bg-white p-2 rounded-2xl shadow-xl flex items-center border border-slate-100 relative z-10">
                  <div className="pl-4 text-slate-400"><Hash size={24} /></div>
                  <input 
                    type="text" 
                    value={searchCode}
                    onChange={(e) => setSearchCode(e.target.value.replace(/[^0-9]/g, ''))} // Solo n√∫meros
                    placeholder="001"
                    maxLength={3}
                    className="w-full p-4 bg-transparent outline-none text-2xl font-black text-slate-800 placeholder:text-slate-300 font-mono"
                  />
                  <button 
                    type="submit"
                    disabled={loading || searchCode.length === 0}
                    className="bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-xl font-bold transition-all disabled:opacity-50 flex items-center justify-center gap-2 w-20"
                  >
                    {loading ? <Loader2 className="animate-spin" size={24} /> : <Search size={24} />}
                  </button>
                </form>
                
                {/* Elementos decorativos de fondo */}
                <div className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-indigo-500/10 rounded-full blur-3xl -z-0"></div>
              </div>
            )}

            {/* VISTA 2: RESULTADO */}
            {activeTab === 'result' && foundPlayer && (
              <div className="w-full animate-fade-in">
                <div className="flex flex-col sm:flex-row justify-between items-center mb-6 no-print bg-white p-4 rounded-xl shadow-sm border border-slate-100 sticky top-16 z-20">
                  <button onClick={() => { setActiveTab(user ? 'admin' : 'home'); setFoundPlayer(null); }} className="flex items-center gap-2 text-slate-500 hover:text-slate-800 py-2 sm:py-0">
                    <X size={18} /> {user ? 'Volver a Admin' : 'Nueva B√∫squeda'}
                  </button>
                  <button onClick={handlePrint} className="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold shadow-lg flex items-center gap-2 hover:bg-indigo-700 transition-colors mt-3 sm:mt-0">
                    <Printer size={18} /> Imprimir Cart√≥n
                  </button>
                </div>
                <FullTicket player={foundPlayer} />
              </div>
            )}

            {/* VISTA 3: LOGIN Y ADMIN */}
            {activeTab === 'admin' && (
              <div className="w-full max-w-4xl animate-fade-in relative z-10">
                {!user ? (
                  // FORMULARIO DE LOGIN
                  <div className="max-w-sm mx-auto bg-white p-8 rounded-2xl shadow-xl border border-slate-100">
                    <h2 className="text-2xl font-black mb-6 text-center text-slate-800">Acceso Administrativo</h2>
                    {authError && <div className="bg-red-100 text-red-700 p-3 rounded-lg text-sm mb-4 text-center border border-red-200">{authError}</div>}
                    <form onSubmit={handleLogin} className="space-y-4">
                      <div>
                        <label className="text-xs font-bold text-slate-400 block mb-1">EMAIL</label>
                        <input 
                          type="email" 
                          required
                          className="w-full border p-3 rounded-lg outline-none focus:border-indigo-500 transition-colors"
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                        />
                      </div>
                      <div>
                        <label className="text-xs font-bold text-slate-400 block mb-1">CONTRASE√ëA</label>
                        <input 
                          type="password" 
                          required
                          className="w-full border p-3 rounded-lg outline-none focus:border-indigo-500 transition-colors"
                          value={password}
                          onChange={(e) => setPassword(e.target.value)}
                        />
                      </div>
                      <button 
                        type="submit"
                        disabled={loading} 
                        className="w-full bg-slate-900 text-white py-3 rounded-lg font-bold hover:bg-slate-800 flex justify-center transition-all disabled:opacity-50"
                      >
                        {loading ? <Loader2 className="animate-spin" size={24}/> : "Entrar"}
                      </button>
                    </form>
                  </div>
                ) : (
                  // PANEL DE ADMINISTRACI√ìN
                  <div className="grid lg:grid-cols-3 gap-6">
                    <div className="lg:col-span-1">
                      <div className="bg-white p-6 rounded-2xl shadow-lg border border-indigo-50 sticky top-24">
                        <h3 className="font-bold text-xl mb-4 flex items-center gap-2 text-indigo-700">
                          <UserPlus size={20}/> Crear Cart√≥n
                        </h3>
                        <form onSubmit={handleCreatePlayer} className="space-y-4">
                          <div>
                            <label className="text-xs font-bold text-slate-400 block mb-1">N√öMERO DE CART√ìN (ID)</label>
                            <input 
                              type="text" 
                              value={newId}
                              onChange={(e) => setNewId(e.target.value.replace(/[^0-9]/g, ''))} // Solo n√∫meros
                              maxLength={3}
                              placeholder="001"
                              required
                              className="w-full bg-indigo-50 border border-indigo-200 rounded-lg p-2 font-mono font-black text-indigo-700 text-lg text-center"
                            />
                          </div>
                          <div>
                            <label className="text-xs font-bold text-slate-400 block mb-1">NOMBRE CLIENTE</label>
                            <input 
                              type="text" 
                              value={newName}
                              onChange={(e) => setNewName(e.target.value)}
                              placeholder="Ej: Juan P√©rez"
                              required
                              className="w-full border-2 border-slate-200 rounded-lg p-2 focus:border-indigo-500 outline-none"
                            />
                          </div>
                          <button 
                            type="submit"
                            disabled={actionLoading} 
                            className="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl font-bold shadow-md transition-all flex justify-center disabled:opacity-50"
                          >
                            {actionLoading ? <Loader2 className="animate-spin" size={24}/> : "Guardar y Generar Cartones"}
                          </button>
                        </form>
                      </div>
                    </div>

                    <div className="lg:col-span-2 bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
                      <div className="p-4 bg-slate-50 border-b border-slate-200 font-bold text-slate-700 flex justify-between items-center">
                        Lista de Cartones Registrados ({players.length})
                      </div>
                      <div className="max-h-[60vh] overflow-y-auto p-2">
                        {players.map((p) => (
                          <div key={p.id} className="flex justify-between items-center p-3 hover:bg-indigo-50 rounded-lg border-b border-slate-100 transition-colors">
                            <div className="flex items-center gap-3">
                              <span className="font-mono font-bold text-indigo-600 bg-indigo-100 px-2 py-1 rounded text-sm">{p.id}</span>
                              <span className="font-medium text-slate-700">{p.name}</span>
                            </div>
                            <div className="flex gap-2">
                               <button title="Ver Cart√≥n" onClick={() => { setFoundPlayer(p); setActiveTab('result'); }} className="p-2 text-blue-500 hover:bg-blue-100 rounded-full transition-colors"><Search size={16}/></button>
                               <button title="Eliminar" onClick={() => handleDelete(p.id, p.name)} className="p-2 text-red-500 hover:bg-red-100 rounded-full transition-colors"><Trash2 size={16}/></button>
                            </div>
                          </div>
                        ))}
                        {players.length === 0 && <p className="text-center p-10 text-slate-400">No hay cartones registrados a√∫n. Usa el formulario de la izquierda.</p>}
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}
          </main>
          
          {/* MODAL DE MENSAJES (Sustituto de alert()) */}
          <div id="error-modal" class="hidden fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-xl shadow-2xl z-[9999] transition-opacity duration-300">
              <p id="modal-message" class="flex items-center gap-2 font-medium"></p>
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));

    </script>
</body>
</html>

