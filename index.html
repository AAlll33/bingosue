<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Master PRO - [NOMBRE DEL CLIENTE]</title>
    <!-- Tailwind CSS (Simplificado) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React y Babel (Necesarios para ejecutar JSX en el navegador) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import { getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot, query, where, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
      import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      
      // Hacemos que las funciones de Firebase estén disponibles globalmente
      window.initializeApp = initializeApp;
      window.getFirestore = getFirestore;
      window.collection = collection;
      window.doc = doc;
      window.setDoc = setDoc;
      window.deleteDoc = deleteDoc;
      window.onSnapshot = onSnapshot;
      window.query = query;
      window.where = where;
      window.getDoc = getDoc;
      window.getAuth = getAuth;
      window.signInWithEmailAndPassword = signInWithEmailAndPassword;
      window.signOut = signOut;
      window.onAuthStateChanged = onAuthStateChanged;

      // Configuraciones de Tailwind
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            animation: {
              'fade-in-up': 'fadeInUp 0.5s ease-out',
              'fade-in': 'fadeIn 0.5s ease-out',
            },
            keyframes: {
              fadeInUp: {
                '0%': { opacity: 0, transform: 'translateY(10px)' },
                '100%': { opacity: 1, transform: 'translateY(0)' },
              },
              fadeIn: {
                '0%': { opacity: 0 },
                '100%': { opacity: 1 },
              }
            }
          },
        }
      }
    </script>

    <!-- Estilo de impresión para el cartón -->
    <style>
        /* Estilos específicos para la impresión */
        @media print {
            /* Oculta todos los elementos excepto el contenido a imprimir */
            body * {
                visibility: hidden;
            }
            /* Muestra el contenedor del ticket y todo su contenido */
            #root, #root * {
                visibility: visible;
            }
            #root {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 0;
            }
            /* Asegura que los elementos de control no se impriman */
            .no-print {
                display: none !important;
            }
            /* Ajusta el tamaño de la cuadrícula para impresión */
            .bingo-grid {
                width: 100%;
            }
        }
        /* Estilos para el efecto de carga */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #ffffff;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 font-sans">
    <!-- Contenedor donde React renderizará la aplicación -->
    <div id="root">
        <div class="h-screen flex items-center justify-center">
            <div class="spinner"></div>
            <p class="ml-4 text-lg text-slate-600">Cargando Bingo App...</p>
        </div>
    </div>

    <!-- Script de la Aplicación (AQUÍ VA TU CÓDIGO REACT/JSX) -->
    <script type="text/babel">
    const { useState, useEffect, createElement } = React;
    
    /**
     * ------------------------------------------------------------------
     * CONFIGURACIÓN DE FIREBASE (¡IMPORTANTE! ESTA SECCIÓN SE EDITA)
     * ------------------------------------------------------------------
     * PASO 1: Cuando crees un nuevo proyecto en Firebase para tu cliente,
     * pega aquí su objeto de configuración completo.
     * ------------------------------------------------------------------
     */
    const firebaseConfig = {
      // ** REEMPLAZAR AQUÍ CON LA CONFIGURACIÓN DEL NUEVO CLIENTE **
  apiKey: "AIzaSyDI3PYFDvQJ1CtF_hLVhhn1jc0_5S1Aog0",
  authDomain: "bingosue-cfca8.firebaseapp.com",
  projectId: "bingosue-cfca8",
  storageBucket: "bingosue-cfca8.firebasestorage.app",
  messagingSenderId: "167707585444",
  appId: "1:167707585444:web:5bbd5ea2d3242df59f6f31"
      // ** FIN DEL BLOQUE DE CONFIGURACIÓN DEL CLIENTE **
    };

    // Inicializamos Firebase y obtenemos las instancias de DB y Auth
    // Usamos las variables globales cargadas por el script type="module"
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Lucide Icons (se importan como componentes React)
    const Search = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('circle', { cx: 11, cy: 11, r: 8 }), createElement('path', { d: "m21 21-4.3-4.3" }));
    const UserPlus = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" }), createElement('circle', { cx: 9, cy: 7, r: 4 }), createElement('line', { x1: 19, y1: 8, x2: 19, y2: 14 }), createElement('line', { x1: 22, y1: 11, x2: 16, y2: 11 }));
    const Trash2 = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "M3 6h18" }), createElement('path', { d: "M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" }), createElement('path', { d: "M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" }), createElement('line', { x1: 10, y1: 11, x2: 10, y2: 17 }), createElement('line', { x1: 14, y1: 11, x2: 14, y2: 17 }));
    const LogOut = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" }), createElement('polyline', { points: "16 17 21 12 16 7" }), createElement('line', { x1: 21, y1: 12, x2: 9, y2: 12 }));
    const Check = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('polyline', { points: "20 6 9 17 4 12" }));
    const Sparkles = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "m12 3-1.83 2.66c-.34.5-1.14.5-1.48 0L6.83 3" }), createElement('path', { d: "m5 10-.64 3.01c-.13.63.38 1.25 1.01 1.38L8 15" }), createElement('path', { d: "m20 10-.64 3.01c-.13.63.38 1.25 1.01 1.38L16 15" }), createElement('path', { d: "m12 21 1.83-2.66c.34-.5 1.14-.5 1.48 0L17.17 21" }), createElement('path', { d: "m7 17-3.64-3.01c-.63-.13-1.14-.75-1.01-1.38L4 10" }), createElement('path', { d: "m17 17 3.64-3.01c.63-.13 1.14-.75 1.01-1.38L20 10" }));
    const Hash = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('line', { x1: 4, y1: 9, x2: 20, y2: 9 }), createElement('line', { x1: 4, y1: 15, x2: 20, y2: 15 }), createElement('line', { x1: 10, y1: 3, x2: 8, y2: 21 }), createElement('line', { x1: 16, y1: 3, x2: 14, y2: 21 }));
    const X = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "M18 6 6 18" }), createElement('path', { d: "m6 6 12 12" }));
    const Printer = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('polyline', { points: "6 9 6 2 18 2 18 9" }), createElement('path', { d: "M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" }), createElement('rect', { width: 12, height: 8, x: 6, y: 14 }), createElement('line', { x1: 12, y1: 14, x2: 12, y2: 22 }));
    const Lock = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('rect', { width: 18, height: 11, x: 3, y: 11, rx: 2, ry: 2 }), createElement('path', { d: "M7 11V7a5 5 0 0 1 10 0v4" }));
    const Loader2 = (props) => createElement('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round", className: props.className || "" }, createElement('path', { d: "M21 12a9 9 0 1 1-6.219-8.56" }));


    /**
     * LOGICA DEL BINGO (Generador Matemático)
     */
    const generateBingoMatrix = () => {
      const getUniqueNumbers = (min, max, count) => {
        const nums = new Set();
        while (nums.size < count) {
          nums.add(Math.floor(Math.random() * (max - min + 1)) + min);
        }
        return Array.from(nums).sort((a, b) => a - b); // Ordenar para mejor visualización
      };
      return {
        B: getUniqueNumbers(1, 15, 5),
        I: getUniqueNumbers(16, 30, 5),
        N: getUniqueNumbers(31, 45, 4), // 4 números + el Free
        G: getUniqueNumbers(46, 60, 5),
        O: getUniqueNumbers(61, 75, 5),
      };
    };

    /**
     * COMPONENTES VISUALES
     */
    const BingoGrid = ({ numbers, colorTheme }) => {
      const { B, I, N, G, O } = numbers;
      const letters = ['B', 'I', 'N', 'G', 'O'];
      const headerColors = {
        blue: ['bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500', 'bg-purple-500'],
        purple: ['bg-pink-500', 'bg-purple-500', 'bg-indigo-500', 'bg-blue-500', 'bg-cyan-500']
      };
      const currentTheme = headerColors[colorTheme] || headerColors.blue;

      // Unir todas las columnas en un solo array para mapear filas
      const columns = [B, I, N, G, O];

      return (
        <div className="bingo-grid bg-white p-2 rounded-lg border-2 border-slate-200 shadow-sm">
          <div className="grid grid-cols-5 gap-1 text-center mb-1">
            {letters.map((l, i) => (
              <div key={l} className={`${currentTheme[i]} text-white font-black text-sm sm:text-lg rounded h-6 sm:h-8 flex items-center justify-center shadow-sm`}>
                {l}
              </div>
            ))}
          </div>
          <div className="grid grid-cols-5 gap-1 text-center font-bold text-slate-800 text-sm sm:text-base">
            {[0, 1, 2, 3, 4].map((row) => (
              <React.Fragment key={row}>
                {columns.map((col, colIndex) => {
                  let content;
                  let cellClass = "h-6 sm:h-8 flex items-center justify-center bg-slate-50 rounded border border-slate-100";
                  
                  // Columna N (índice 2) y Fila 2 (índice 2) es el espacio libre
                  if (colIndex === 2 && row === 2) {
                    content = <Sparkles size={14} className="text-white" />;
                    cellClass = "h-6 sm:h-8 flex items-center justify-center bg-yellow-400 rounded-full border-2 border-yellow-200";
                  } else {
                    // Manejar la columna N que solo tiene 4 números
                    let number;
                    if (colIndex === 2) {
                      number = row < 2 ? col[row] : col[row - 1];
                    } else {
                      number = col[row];
                    }
                    content = number;
                  }

                  return (
                    <div key={colIndex} className={cellClass}>
                      {content}
                    </div>
                  );
                })}
              </React.Fragment>
            ))}
          </div>
        </div>
      );
    };

    const FullTicket = ({ player }) => {
      // Asegurar que player y player.grids existan
      if (!player || !player.grids || player.grids.length < 2) return null;

      return (
        <div id="bingo-ticket-export" className="bg-white p-4 sm:p-6 rounded-3xl shadow-2xl max-w-3xl mx-auto border-t-8 border-indigo-600 relative overflow-hidden">
          <div className="text-center mb-6 relative z-10">
            <div className="inline-flex items-center justify-center gap-2 bg-indigo-100 text-indigo-700 px-4 py-1 rounded-full text-sm font-bold mb-2">
              <Hash size={14} /> TICKET #{player.id}
            </div>
            <h2 className="text-3xl sm:text-4xl font-black text-slate-800 uppercase">GRAN BINGO <span className="text-indigo-600">MASTER</span></h2>
            <p className="text-slate-500 font-medium text-lg mt-1 uppercase">{player.name}</p>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 relative z-10">
            <div className="relative">
              <div className="absolute -top-3 -left-2 bg-yellow-400 text-yellow-900 font-bold w-8 h-8 flex items-center justify-center rounded-full border-2 border-white shadow-lg z-20 text-xs">01</div>
              <BingoGrid numbers={player.grids[0]} colorTheme="blue" />
            </div>
            <div className="relative">
              <div className="absolute -top-3 -right-2 bg-yellow-400 text-yellow-900 font-bold w-8 h-8 flex items-center justify-center rounded-full border-2 border-white shadow-lg z-20 text-xs">02</div>
              <BingoGrid numbers={player.grids[1]} colorTheme="purple" />
            </div>
          </div>
          <div className="mt-6 pt-4 border-t border-dashed border-slate-300 flex justify-between items-center text-xs text-slate-400">
            <span>Generado automáticamente</span>
            <span className="flex items-center gap-1"><Check size={12} /> Verificado</span>
          </div>
        </div>
      );
    };

    /**
     * APP PRINCIPAL
     */
    const App = () => {
      const [activeTab, setActiveTab] = useState('home'); 
      const [players, setPlayers] = useState([]);
      const [searchCode, setSearchCode] = useState('');
      const [foundPlayer, setFoundPlayer] = useState(null);
      
      // Auth States
      const [user, setUser] = useState(null);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [authError, setAuthError] = useState('');

      // Admin Action States
      const [newName, setNewName] = useState('');
      const [newId, setNewId] = useState('');
      const [loading, setLoading] = useState(false);
      const [actionLoading, setActionLoading] = useState(false);

      // 1. Escuchar Autenticación
      useEffect(() => {
        const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
          setUser(currentUser);
        });
        return () => unsubscribe();
      }, []);

      // 2. Escuchar Base de Datos (Solo si es admin, para ahorrar lecturas)
      useEffect(() => {
        if (user && activeTab === 'admin') {
          try {
            // Regla 1: Solo el usuario administrador (uid) debe poder acceder a esta data
            // Esto requiere una regla de seguridad en Firestore que valide:
            // allow read: if request.auth.uid == 'TU_UID_ADMIN';
            const q = query(collection(db, "players"));
            const unsubscribe = onSnapshot(q, (querySnapshot) => {
              const playersList = [];
              querySnapshot.forEach((doc) => {
                playersList.push({ id: doc.id, ...doc.data() }); // Incluir doc.id por si lo necesitamos
              });
              // Ordenar por ID
              playersList.sort((a, b) => parseInt(a.id) - parseInt(b.id));
              setPlayers(playersList);
              
              // Calcular siguiente ID
              if(playersList.length > 0) {
                  const lastId = Math.max(...playersList.map(p => parseInt(p.id)));
                  setNewId(String(lastId + 1).padStart(3, '0'));
              } else {
                  setNewId('001');
              }
            });
            return () => unsubscribe();
          } catch (e) {
            console.error("Error al suscribirse a Firestore:", e);
            // Mostrar un error al admin si falla la conexión
            setAuthError("Error de conexión con la base de datos. Revisa la consola o las reglas de seguridad.");
            return () => {}; // Devuelve una función vacía si hubo error
          }
        } else {
            setPlayers([]); // Limpiar si no es admin
            return () => {};
        }
      }, [user, activeTab]);

      // --- MÉTODOS ---

      const handleSearch = async (e) => {
        e.preventDefault();
        // El ID debe ser un número de 3 dígitos (ej: '001')
        const formattedCode = searchCode.padStart(3, '0');
        if(!formattedCode || formattedCode.length > 3) return;
        setLoading(true);
        setFoundPlayer(null);

        try {
          // Regla 2: La lectura individual del cartón NO requiere autenticación.
          // Esto requiere una regla de seguridad en Firestore que valide:
          // match /players/{playerId} { allow read: true; }
          const docRef = doc(db, "players", formattedCode);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists()) {
            setFoundPlayer(docSnap.data());
            setActiveTab('result');
          } else {
             // Usar un modal simple o un div de error en lugar de alert()
             document.getElementById('modal-message').innerText = '❌ No encontramos ese número de cartón.';
             document.getElementById('error-modal').classList.remove('hidden');
             setTimeout(() => document.getElementById('error-modal').classList.add('hidden'), 3000);
          }
        } catch (error) {
          console.error("Error buscando:", error);
           document.getElementById('modal-message').innerText = "Error de conexión. Intenta más tarde.";
           document.getElementById('error-modal').classList.remove('hidden');
           setTimeout(() => document.getElementById('error-modal').classList.add('hidden'), 3000);
        }
        setLoading(false);
      };

      const handleLogin = async (e) => {
        e.preventDefault();
        setAuthError('');
        setLoading(true);
        // NOTA IMPORTANTE: Para que esto funcione, debes crear un usuario
        // en Firebase Authentication con este email/password ANTES de usarlo.
        try {
          await signInWithEmailAndPassword(auth, email, password);
          setActiveTab('admin');
        } catch (error) {
          setAuthError('Credenciales incorrectas o usuario no existe. Revisa tu email y contraseña.');
        }
        setLoading(false);
      };

      const handleLogout = async () => {
        await signOut(auth);
        setActiveTab('home');
      };

      const handleCreatePlayer = async (e) => {
        e.preventDefault();
        const formattedId = newId.padStart(3, '0');
        if(!newName || !formattedId) return;
        setActionLoading(true);

        try {
          // Primero, verificar si el ID ya existe para evitar sobrescribir accidentalmente
          const docRef = doc(db, "players", formattedId);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists() && !window.confirm(`El cartón #${formattedId} ya existe para ${docSnap.data().name}. ¿Quieres sobrescribirlo?`)) {
              setActionLoading(false);
              return;
          }

          // Usamos setDoc para definir nosotros el ID del documento (ej: "001")
          await setDoc(docRef, {
            id: formattedId,
            name: newName,
            createdAt: new Date().toISOString(),
            grids: [generateBingoMatrix(), generateBingoMatrix()]
          });
          setNewName('');
          // El ID se recalculará con el onSnapshot
          document.getElementById('modal-message').innerText = `✅ Cartón #${formattedId} creado/actualizado para ${newName}`;
          document.getElementById('error-modal').classList.remove('hidden');
          setTimeout(() => document.getElementById('error-modal').classList.add('hidden'), 3000);
          
        } catch (error) {
          console.error("Error creando:", error);
           document.getElementById('modal-message').innerText = "Error al guardar en base de datos. Revisa las reglas de 'write'.";
           document.getElementById('error-modal').classList.remove('hidden');
           setTimeout(() => document.getElementById('error-modal').classList.add('hidden'), 3000);
        }
        setActionLoading(false);
      };

      const handleDelete = async (id) => {
        if(window.confirm(`¿Estás seguro de borrar el cartón #${id}?`)) {
          try {
            await deleteDoc(doc(db, "players", id));
          } catch (error) {
             document.getElementById('modal-message').innerText = "Error al eliminar. Revisa las reglas de seguridad.";
             document.getElementById('error-modal').classList.remove('hidden');
             setTimeout(() => document.getElementById('error-modal').classList.add('hidden'), 3000);
          }
        }
      };

      const handlePrint = () => window.print();

      return (
        <div className="min-h-screen bg-slate-50 text-slate-800 font-sans selection:bg-indigo-200">
          {/* NAVBAR */}
          <nav className="bg-white sticky top-0 z-50 border-b border-slate-200 no-print shadow-sm">
            <div className="max-w-5xl mx-auto px-4 h-16 flex justify-between items-center">
              <div 
                onClick={() => { setActiveTab('home'); setSearchCode(''); setFoundPlayer(null); }}
                className="flex items-center gap-2 cursor-pointer"
              >
                <Sparkles className="text-indigo-600 fill-indigo-100" />
                <span className="font-black text-xl tracking-tight">BINGO<span className="text-indigo-600">PRO</span></span>
              </div>

              {user ? (
                 <button onClick={() => setActiveTab('admin')} className="text-sm font-medium text-slate-500 hover:text-indigo-600 flex items-center gap-1">
                    <Lock size={16}/> ADMIN
                 </button>
              ) : (
                <button onClick={() => setActiveTab('admin')} className="text-sm font-medium text-slate-500 hover:text-indigo-600 flex items-center gap-1">
                  <Lock size={16}/> Admin
                </button>
              )}
              
              {user && (
                 <button onClick={handleLogout} className="text-sm font-medium text-red-500 flex items-center gap-1">
                   <LogOut size={16}/> Salir
                 </button>
              )}
            </div>
          </nav>

          <main className="max-w-5xl mx-auto p-4 md:p-8 flex flex-col items-center min-h-[80vh]">

            {/* VISTA 1: BUSCADOR */}
            {activeTab === 'home' && (
              <div className="w-full max-w-md mt-10 animate-fade-in-up text-center">
                <div className="mb-8">
                  <h1 className="text-4xl font-black text-slate-900 mb-2">Busca tu Cartón</h1>
                  <p className="text-slate-500">Ingresa tu número de ticket para ver tus cartas.</p>
                </div>

                <form onSubmit={handleSearch} className="bg-white p-2 rounded-2xl shadow-xl flex items-center border border-slate-100 relative z-10">
                  <div className="pl-4 text-slate-400"><Hash size={24} /></div>
                  <input 
                    type="text" 
                    value={searchCode}
                    onChange={(e) => setSearchCode(e.target.value)}
                    placeholder="001"
                    maxLength={3}
                    className="w-full p-4 bg-transparent outline-none text-2xl font-black text-slate-800 placeholder:text-slate-300 font-mono"
                  />
                  <button 
                    type="submit"
                    disabled={loading}
                    className="bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-xl font-bold transition-all disabled:opacity-50 flex items-center justify-center gap-2 w-20"
                  >
                    {loading ? <Loader2 className="animate-spin" size={24} /> : <Search size={24} />}
                  </button>
                </form>
                
                {/* Elementos decorativos de fondo */}
                <div className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-indigo-500/10 rounded-full blur-3xl -z-0"></div>
              </div>
            )}

            {/* VISTA 2: RESULTADO */}
            {activeTab === 'result' && foundPlayer && (
              <div className="w-full animate-fade-in">
                <div className="flex justify-between items-center mb-6 no-print bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                  <button onClick={() => { setActiveTab('home'); setFoundPlayer(null); }} className="flex items-center gap-2 text-slate-500 hover:text-slate-800">
                    <X size={18} /> Cerrar Búsqueda
                  </button>
                  <button onClick={handlePrint} className="bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold shadow-lg flex items-center gap-2 hover:bg-indigo-700">
                    <Printer size={18} /> Imprimir Cartón
                  </button>
                </div>
                <FullTicket player={foundPlayer} />
              </div>
            )}

            {/* VISTA 3: LOGIN Y ADMIN */}
            {activeTab === 'admin' && (
              <div className="w-full max-w-4xl animate-fade-in relative z-10">
                {!user ? (
                  // FORMULARIO DE LOGIN
                  <div className="max-w-sm mx-auto bg-white p-8 rounded-2xl shadow-xl border border-slate-100">
                    <h2 className="text-xl font-bold mb-6 text-center">Acceso Administrativo</h2>
                    {authError && <div className="bg-red-50 text-red-600 p-3 rounded-lg text-sm mb-4 text-center">{authError}</div>}
                    <form onSubmit={handleLogin} className="space-y-4">
                      <div>
                        <label className="text-xs font-bold text-slate-400">EMAIL</label>
                        <input 
                          type="email" 
                          required
                          className="w-full border p-3 rounded-lg outline-none focus:border-indigo-500"
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                        />
                      </div>
                      <div>
                        <label className="text-xs font-bold text-slate-400">CONTRASEÑA</label>
                        <input 
                          type="password" 
                          required
                          className="w-full border p-3 rounded-lg outline-none focus:border-indigo-500"
                          value={password}
                          onChange={(e) => setPassword(e.target.value)}
                        />
                      </div>
                      <button disabled={loading} className="w-full bg-slate-900 text-white py-3 rounded-lg font-bold hover:bg-slate-800 flex justify-center">
                        {loading ? <Loader2 className="animate-spin" size={24}/> : "Entrar"}
                      </button>
                    </form>
                  </div>
                ) : (
                  // PANEL DE ADMINISTRACIÓN
                  <div className="grid lg:grid-cols-3 gap-6">
                    <div className="lg:col-span-1">
                      <div className="bg-white p-6 rounded-2xl shadow-lg border border-indigo-50 sticky top-24">
                        <h3 className="font-bold text-lg mb-4 flex items-center gap-2 text-indigo-700">
                          <UserPlus size={20}/> Nuevo Jugador
                        </h3>
                        <form onSubmit={handleCreatePlayer} className="space-y-4">
                          <div>
                            <label className="text-xs font-bold text-slate-400">NÚMERO DE CARTÓN</label>
                            <input 
                              type="text" 
                              value={newId}
                              onChange={(e) => setNewId(e.target.value.replace(/[^0-9]/g, ''))} // Solo números
                              maxLength={3}
                              placeholder="001"
                              className="w-full bg-slate-50 border border-slate-200 rounded-lg p-2 font-mono font-bold text-indigo-700"
                            />
                          </div>
                          <div>
                            <label className="text-xs font-bold text-slate-400">NOMBRE CLIENTE</label>
                            <input 
                              type="text" 
                              value={newName}
                              onChange={(e) => setNewName(e.target.value)}
                              placeholder="Ej: Juan Pérez"
                              required
                              className="w-full border-2 border-slate-200 rounded-lg p-2 focus:border-indigo-500 outline-none"
                            />
                          </div>
                          <button disabled={actionLoading} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl font-bold shadow-md transition-all flex justify-center">
                            {actionLoading ? <Loader2 className="animate-spin" size={24}/> : "Guardar y Generar"}
                          </button>
                        </form>
                      </div>
                    </div>

                    <div className="lg:col-span-2 bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
                      <div className="p-4 bg-slate-50 border-b border-slate-200 font-bold text-slate-700 flex justify-between items-center">
                        Lista de Cartones ({players.length})
                      </div>
                      <div className="max-h-[500px] overflow-y-auto p-2">
                        {players.map((p) => (
                          <div key={p.id} className="flex justify-between items-center p-3 hover:bg-indigo-50 rounded-lg border-b border-slate-50">
                            <div className="flex items-center gap-3">
                              <span className="font-mono font-bold text-indigo-600 bg-indigo-100 px-2 py-1 rounded text-sm">{p.id}</span>
                              <span className="font-medium">{p.name}</span>
                            </div>
                            <div className="flex gap-2">
                               <button title="Ver Cartón" onClick={() => { setFoundPlayer(p); setActiveTab('result'); }} className="p-2 text-blue-500 hover:bg-blue-100 rounded-full"><Search size={16}/></button>
                               <button title="Eliminar" onClick={() => handleDelete(p.id)} className="p-2 text-red-500 hover:bg-red-100 rounded-full"><Trash2 size={16}/></button>
                            </div>
                          </div>
                        ))}
                        {players.length === 0 && <p className="text-center p-10 text-slate-400">Sin registros en la base de datos.</p>}
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}
          </main>
          
          {/* MODAL DE MENSAJES (Sustituto de alert()) */}
          <div id="error-modal" class="hidden fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-xl shadow-2xl z-[9999] transition-opacity duration-300">
              <p id="modal-message" class="flex items-center gap-2 font-medium"></p>
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));

    </script>
</body>
</html>
